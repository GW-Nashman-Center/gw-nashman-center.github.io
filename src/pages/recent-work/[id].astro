---
import recentWork from "../../data/recent-work.json";

// Import all markdown files at build time
const markdownFiles = import.meta.glob('../../docs/*.md');

export function getStaticPaths() {
  return recentWork.map((item) => ({
    params: { id: item.id }
  }));
}

const { id } = Astro.params;

const item = recentWork.find((w) => w.id === id);

if (!item) {
  throw new Error("Not found");
}

// Convert the path from item to match the glob pattern
// If item.path is like "/docs/filename.md", convert to "../../docs/filename.md"
const markdownPath = `../../docs/${item.path.split('/').pop()}`;

// Get the correct module
const markdownModule = markdownFiles[markdownPath];

if (!markdownModule) {
  throw new Error(`Markdown file not found: ${markdownPath}`);
}

// Load the markdown content
const Markdown = await markdownModule();
---

<main>
  <h1>{item.title}</h1>

  <p><strong>Creator:</strong> {item.creator}</p>
  <p><strong>Type:</strong> {item.type}</p>

  <hr />

  <Markdown.default />
</main>

<style>
  main {
    max-width: 800px;
    margin: 3rem auto;
    padding: 0 1rem;
  }
</style>
